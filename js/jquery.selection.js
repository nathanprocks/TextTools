(function(g,h,e){var k=function(a){var b={text:"",start:0,end:0};if(!a.value)return b;try{if(h.getSelection)b.start=a.selectionStart,b.end=a.selectionEnd,b.text=a.value.slice(b.start,b.end);else if(e.selection){a.focus();var d=e.selection.createRange(),c=e.body.createTextRange();b.text=d.text;try{c.moveToElementText(a),c.setEndPoint("StartToStart",d)}catch(l){c=a.createTextRange(),c.setEndPoint("StartToStart",d)}b.start=a.value.length-c.text.length;b.end=b.start+d.text.length}}catch(g){}return b},
f={getPos:function(a){a=k(a);return{start:a.start,end:a.end}},setPos:function(a,b,d){d=this._caretMode(d);"start"==d?b.end=b.start:"end"==d&&(b.start=b.end);a.focus();try{if(a.createTextRange){var c=a.createTextRange();0<=h.navigator.userAgent.toLowerCase().indexOf("msie")&&(b.start=a.value.substr(0,b.start).replace(/\r/g,"").length,b.end=a.value.substr(0,b.end).replace(/\r/g,"").length);c.collapse(!0);c.moveStart("character",b.start);c.moveEnd("character",b.end-b.start);c.select()}else a.setSelectionRange&&
a.setSelectionRange(b.start,b.end)}catch(g){}},getText:function(a){return k(a).text},_caretMode:function(a){a=a||"keep";!1==a&&(a="end");switch(a){case "keep":case "start":case "end":break;default:a="keep"}return a},replace:function(a,b,d){var c=k(a),l=a.value,e=g(a).scrollTop(),f={start:c.start,end:c.start+b.length};a.value=l.substr(0,c.start)+b+l.substr(c.end);g(a).scrollTop(e);this.setPos(a,f,d)},insertBefore:function(a,b,d){var c=k(a),e=a.value,f=g(a).scrollTop(),h={start:c.start+b.length,end:c.end+
b.length};a.value=e.substr(0,c.start)+b+e.substr(c.start);g(a).scrollTop(f);this.setPos(a,h,d)},insertAfter:function(a,b,d){var c=k(a),e=a.value,f=g(a).scrollTop(),h={start:c.start,end:c.end};a.value=e.substr(0,c.end)+b+e.substr(c.end);g(a).scrollTop(f);this.setPos(a,h,d)}};g.extend({selection:function(a){a="text"==(a||"text").toLowerCase();try{if(h.getSelection){if(a)return h.getSelection().toString();var b=h.getSelection(),d;b.getRangeAt?d=b.getRangeAt(0):(d=e.createRange(),d.setStart(b.anchorNode,
b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset));return g("<div></div>").append(d.cloneContents()).html()}if(e.selection)return a?e.selection.createRange().text:e.selection.createRange().htmlText}catch(c){}return""}});g.fn.extend({selection:function(a,b){b=b||{};switch(a){case "getPos":return f.getPos(this[0]);case "setPos":return this.each(function(){f.setPos(this,b)});case "replace":return this.each(function(){f.replace(this,b.text,b.caret)});case "insert":return this.each(function(){"before"==
b.mode?f.insertBefore(this,b.text,b.caret):f.insertAfter(this,b.text,b.caret)});default:return f.getText(this[0])}}})})(jQuery,window,window.document);